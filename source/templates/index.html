<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Qubit - Image Restoration</title>
        <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
        <link rel=stylesheet type=text/css href="https://bootswatch.com/4/simplex/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://bootswatch.com/_vendor/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="https://bootswatch.com/_vendor/popper.js/dist/umd/popper.min.js"></script>
    </head>
    <body class="page">
        <h1>Qubit Team</h1>
        <hr/>
        <h2 class="center">Image Restoration</h2>
        <table class="table-main" border="0">
            <tbody>
                <tr class='center'>
                    <td><h5>Original Image</h5></td>
                    <td></td>
                    <td><h5>Filtered Image</h5></td>
                </tr>
                <tr>
                    <td width="45%">
                        <!--Fill with image template-->
                        <div id="source_img"></div>
                    </td>
                    <td width="10%"></td>
                    <td width="45%%">
                        <!--Fill with image template-->
                        <div id="target_img"></div>
                    </td>
                </tr>

                <tr class='right'>
                    <td>
                        <form id="browse_form" enctype="multipart/form-data">
                            <spa>
                                <input type="file" name="image">
                                <input id="upload_btn" type=button class="btn btn-primary" value=Upload>
                            </spa>
                        </form>
                    </td>
                    <td></td>
                    <td>
                        <input id="apply_btn" type="button" class="btn btn-primary" value="Apply">
                    </td>
                </tr>
                <tr>
                    <td><h3>Select filter:</h3></td>
                    <td></td>
                    <td><h3>Display options:</h3></td>
                </tr>
                <tr>
                    <td>
                        <!--Static template for filter settings-->
                        <div id="filter_wrapper"></div>
                    </td>
                    <td></td>
                    <td valign="top">
                        <!--Static template for display options-->
                        <div id="display_wrapper" class="tab"></div>
                    </td>
                </tr>
            </tbody>
        </table>
        <hr />
    </body>
</html>

<script>
    $("#filter_wrapper").load('static/filter.html');
    $("#display_wrapper").load('static/display.html');

    $("#upload_btn").click(function(){
        $.ajax({
            type: "POST",
            url: "/upload",
            data: new FormData($('#browse_form')[0]),
            processData: false,
            contentType: false,
            success: function(response) {
                $("#source_img").html(response);
            },
            error: function(xhr) {
                alert("You didn't select an image!");
            }
        });
    });

    $("#apply_btn").click(function () {
        // data structure
        var data = {
            'filter': null,
            'filter_settings': null,
            'display': null
        };

        // Filter settings
        data['filter'] = $("input[name='filterchoice']:checked").val();
        switch(data['filter'])
        {
            case "bandreject":
                var filterType = $('#bandreject_type').val();
                var thickness = $('#thickness').val();
                var radius = $('#radius').val();
                var settings = {
                    'type': filterType,
                    'thickness':thickness,
                    'radius': radius
                };
                data['filter_settings'] = settings;
                break;

            case "notch":
                var filterType = $('#notch_type').val();
                var settings = { 'type': filterType };
                data['filter_settings'] = settings;
                break;
            default:
                data['filter_settings'] = {};
        };

        // Display options
        data['display'] = $("input[name='displaychoice']:checked").val();

        // Debug alert
        alert(JSON.stringify(data, null, '\t'));

        // Ajax request
        $.ajax({
            type: "POST",
            url: "/apply",
            data: JSON.stringify(data, null, '\t'),
            contentType: 'application/json;charset=UTF-8',
            success: function(response) {
                $("#target_img").html(response);
            },
            error: function(xhr) {
                alert("Something went wrong!");
            }
        });
    });
</script>







